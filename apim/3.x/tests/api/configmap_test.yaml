suite: Test Management API default configmap
templates:
  - "api/api-secret.yaml"
tests:
  - it: Set jwt attributes with default values if not set
    template: api/api-secret.yaml
    set:
      jwt:
        key: value
    asserts:
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "expire-after: 604800"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "email-registration-expire-after: 86400"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "issuer: gravitee-management-auth"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-path: /"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-domain: apim.example.com"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-secure: false"
  - it: Set jwt attributes with provided values
    template: api/api-secret.yaml
    set:
      jwt:
        expireAfter: 1000
        emailRegistrationExpireAfter: 2000
        issuer: "gravitee-management-auth-test"
        cookie:
          path: "/test"
          domain: "apim.test"
          secure: true
    asserts:
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "expire-after: 1000"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "email-registration-expire-after: 2000"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "issuer: gravitee-management-auth-test"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-path: /test"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-domain: apim.test"
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "cookie-secure: true"
  - it: Set console Pendo analytics attributes with provided values
    template: api/api-secret.yaml
    set:
      ui:
        analytics:
          pendo:
            enabled: true
            apiKey: "myPendoKey"
    asserts:
      - matchRegex:
          path: stringData.[gravitee.yml]
          pattern: "apiKey: myPendoKey"
